<div id="jellyBridgeConfigurationPage" data-role="page" class="page type-interior pluginConfigurationPage" data-controller="__plugin/ConfigurationPage.js">
    <div data-role="content">
        <div class="content-primary">
            <style>
                span.link {
                    cursor: pointer;
                    color: #00a4dc;
                    text-decoration: underline;
                }
                span.link:hover {
                    color: #0088cc;
                    text-decoration: underline;
                }
                summary {
                    cursor: pointer;
                    padding: 10px;
                    width: inherit;
                    margin: auto;
                    border: none;
                    text-align: center;
                    font-size: 1em;
                    outline: 2px solid rgba(155, 155, 155, 0.5);
                }
                h3.checkboxListLabel {
                    font-size: 1em;
                    margin-bottom: 4px;
                }
                code {
                    white-space: nowrap;
                }
                /* Disabled state styling */
                .disabled-block {
                    opacity: .6;
                }
                .disabled-block input,
                .disabled-block select,
                .disabled-block button {
                    pointer-events: none;
                    cursor: not-allowed;
                }
                .disabled-block .inputLabel,
                .disabled-block label.emby-checkbox-label span {
                    font-style: italic;
                }
                
                /* Multi-select styling */
                .multiSelectContainer {
                    display: flex;
                    gap: 20px;
                    margin-top: 10px;
                    align-items: stretch;
                }
                
                .selectBoxHeader {
                    display: flex;
                    align-items: center;
                    margin-bottom: 8px;
                }
                
                .selectBoxHeader .inputLabel {
                    margin: 0;
                    flex: 1;
                }
                
                .arrowButtonsContainer {
                    display: flex;
                    flex-direction: column;
                    justify-content: center;
                    align-items: center;
                    width: 10%
                }
                
                .arrowButton {
                    font-size: 18px;
                    font-weight: bold;
                    width: 40px;
                    height: 40px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    margin-bottom: 5px;
                }
                
                .selectBox {
                    width: 45%;
                }
                
                .selectBox .emby-select {
                    min-height: 200px;
                    flex: 1;
                    margin-bottom: 8px;
                }
                
                /* Scrollbar styling for emby-select */
                .emby-select::-webkit-scrollbar {
                    width: 20px;
                    height: 12px;
                }
                
                .emby-select::-webkit-scrollbar-track {
                    background: rgba(255, 255, 255, 0.1);
                    border-radius: 6px;
                }
                
                .emby-select::-webkit-scrollbar-thumb {
                    background: rgba(255, 255, 255, 0.3);
                    border-radius: 6px;
                    border: 2px solid transparent;
                    background-clip: content-box;
                }
                
                .emby-select::-webkit-scrollbar-thumb:hover {
                    background: rgba(255, 255, 255, 0.5);
                    background-clip: content-box;
                }
                
                /* Help icon styling */
                .helpIcon {
                    display: inline-block;
                    width: 24px;
                    height: 24px;
                    background: #0078d4;
                    color: white;
                    border-radius: 50%;
                    text-align: center;
                    line-height: 24px;
                    font-size: 16px;
                    font-weight: bold;
                    margin-left: 5px;
                    vertical-align: middle;
                }
                
                .helpButton:hover .helpIcon {
                    background: #106ebe;
                }
                
                #IsEnabledContainer {
                    display: flex;
                    /* flex:0; */
                    white-space: nowrap;
                }
                
                .helpButton {
                    cursor: help;
                    display: flex;
                    /* flex: 1; */
                    min-width: 100px;
                    width: 32px;
                    height: 32px;
                    line-height: 32px;
                    align-items: center;
                    justify-content: flex-end;
                }
                
                .cautionText {
                    color: #ff9800;
                    font-size: 0.85em;
                    margin-top: 8px;
                }
                
                .criticalText {
                    color: #ff6b6b;
                    font-size: 0.85em;
                    margin-top: 8px;
                }
                
                .setupInstructions {
                    border-radius: 4px;
                    padding: 0px;
                    margin-top: 0px;
                    margin-bottom: 16px;
                }

                /* Search input with clear button */
                .searchInputContainer {
                    position: relative;
                    margin-bottom: 8px;
                }
                
                .searchInputContainer .emby-input {
                    padding-right: 30px;
                    margin-bottom: 0;
                }
                
                .clearSearchButton {
                    position: absolute;
                    right: 8px;
                    top: 50%;
                    transform: translateY(-50%);
                    background: none;
                    border: none;
                    color: #999;
                    font-size: 18px;
                    font-weight: bold;
                    cursor: pointer;
                    padding: 0;
                    width: 20px;
                    height: 20px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    border-radius: 50%;
                    transition: all 0.2s ease;
                }
                
                .clearSearchButton:hover {
                    background-color: #666;
                    color: #fff;
                }
                
                .clearSearchButton:not([style*="display: none"]) {
                    display: flex;
                }
                
                /* Disabled state for Library Prefix */
                .disabled {
                    opacity: 0.6;
                    cursor: not-allowed;
                    /* Allow pointer events on container so scroll handlers work */
                }
                
                /* Block pointer events only on form elements, not the container */
                .disabled input,
                .disabled select,
                .disabled textarea,
                .disabled button {
                    pointer-events: none;
                    cursor: not-allowed;
                }
                
                .disabled .inputLabel,
                .disabled label,
                .disabled .emby-input-label {
                    color: #999 !important;
                    cursor: not-allowed;
                }
                
                /* Allow pointer events on help icon even when container is disabled */
                .disabled .helpIcon {
                    pointer-events: auto;
                    cursor: pointer;
                }
                
                /* Disabled button styling */
                button:disabled {
                    opacity: 0.6;
                    pointer-events: none;
                    cursor: not-allowed;
                }
                
                /* Refresh button styling */
                .refreshButton {
                    background: none;
                    border: none;
                    padding: 0;
                    margin: 0;
                    cursor: pointer;
                    font-size: inherit;
                    transition: transform 0.2s ease;
                }
                
                .refreshButton:hover {
                    transform: rotate(180deg);
                }
                
                /* Task status container styling */
                .taskStatusContainer {
                    margin-bottom: 20px;
                    padding: 15px;
                    background-color: rgba(0, 0, 0, 0.1);
                    border-radius: 8px;
                }
                
                .taskStatusHeader {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 10px;
                }
                
                .taskStatusHeader h3 {
                    margin: 0;
                    font-size: 1.1em;
                }
                
                .taskStatusText {
                    font-weight: bold;
                    color: #666;
                }
                
                .taskProgressContainer {
                    display: none;
                }
                
                .taskProgressText {
                    text-align: center;
                    margin-top: 5px;
                    font-size: 0.9em;
                    color: #999;
                }
                
                .taskStatusTimes {
                    font-size: 0.85em;
                    color: #888;
                    margin-top: 8px;
                }
                
                /* Troubleshooting details styling - left-aligned and distinct */
                details.detailedInstructions {
                    margin-top: 16px;
                }
                
                /* Network folder options - padding below instead of above */
                #networkFolderOptionsDetails {
                    margin-top: 0;
                    margin-bottom: 16px;
                }
                
                details.detailedInstructions summary {
                    cursor: pointer;
                    padding: 8px 12px;
                    width: auto;
                    margin: 0;
                    margin-bottom: 0;
                    border: none;
                    text-align: left;
                    font-size: 1em;
                    font-weight: bold;
                    outline: 1px solid rgba(155, 155, 155, 0.3);
                    border-radius: 4px 4px 0 0;
                    background-color: rgba(0, 0, 0, 0.05);
                    display: inline-block;
                    list-style: none;
                }
                
                details.detailedInstructions summary::-webkit-details-marker {
                    display: none;
                }
                
                details.detailedInstructions summary::before {
                    content: "‚ñ∂";
                    display: inline-block;
                    margin-right: 8px;
                    transition: transform 0.2s ease;
                    font-size: 0.8em;
                }
                
                details.detailedInstructions[open] summary::before {
                    transform: rotate(90deg);
                }
                
                details.detailedInstructions summary:hover {
                    background-color: rgba(0, 0, 0, 0.1);
                }
                
                details.detailedInstructions[open] > div {
                    border: 1px solid rgba(155, 155, 155, 0.3);
                    border-top: none;
                    border-radius: 0 0 4px 4px;
                    padding: 12px;
                    margin-top: 0;
                }
                
                /* Disabled state for details elements */
                details.detailedInstructions.disabled {
                    opacity: 0.6;
                    /* Allow pointer events so click handlers work */
                }
                
                details.detailedInstructions.disabled summary {
                    cursor: pointer; /* Keep pointer cursor to indicate it's clickable */
                    background-color: rgba(0, 0, 0, 0.02);
                    pointer-events: auto; /* Ensure summary remains clickable */
                }
                
                details.detailedInstructions.disabled summary:hover {
                    background-color: rgba(0, 0, 0, 0.05); /* Slightly darker on hover to show it's interactive */
                }
                
                /* Result textarea styling - max height and scroll after 25 lines */
                .testResult {
                    display: none;
                    max-height: 600px; /* ~25 lines * 20px + 10px */
                    overflow-y: auto;
                    font-family: 'Courier New', monospace;
                    margin-top: 10px;
                    white-space: pre-wrap;
                }
            </style>
            <form id="jellyBridgeConfigurationForm" autocomplete="off">
                <fieldset class="verticalSection-extrabottompadding">
                    <legend>JellyBridge Configuration</legend>
                    
                    <!-- Task Status Progress Bar -->
                    <div id="taskStatusContainer" class="taskStatusContainer">
                        <div class="taskStatusHeader">
                            <h3>
                                <button type="button" id="refreshTaskStatus" is="emby-button" class="refreshButton" title="Refresh status">üîÑ</button> Automated Sync Status
                            </h3>
                            <span id="taskStatusText" class="taskStatusText">Checking...</span>
                        </div>
                        <div id="taskProgressContainer" class="taskProgressContainer">
                            <div class="itemProgressBar">
                                <div class="itemProgressBarForeground" id="taskProgressBar" style="width: 0%;"></div>
                            </div>
                            <div id="taskProgressText" class="taskProgressText"></div>
                        </div>
                        <div id="taskStatusTimes" class="taskStatusTimes"></div>
                    </div>
                    
                    

                    <div class="inputContainer">
                        <input is="emby-input" type="url" id="JellyseerrUrl" label="Jellyseerr URL" autocomplete="one-time-code" data-form-type="other" />
                        <div class="fieldDescription">The base URL of your Jellyseerr instance. For docker instances, use http://host.docker.internal:5055</div>
                    </div>

                    <div class="inputContainer">
                        <input is="emby-input" type="password" id="ApiKey" label="API Key" autocomplete="one-time-code" data-1p-ignore data-bwignore data-lpignore="true" data-form-type="other" />
                        <div class="fieldDescription">Your Jellyseerr API key, usually accessible from <a target="_blank" href="http://localhost:5055/settings">localhost on port 5055</a>.</div>
                    </div>

                    <div class="inputContainer">
                        <input is="emby-input" type="text" id="LibraryDirectory" label="Library Directory" />
                        <div class="fieldDescription">Directory path for Jellyseerr library files. Ensure that this path is used only for the JellyBridge library. The <span class="link" data-target-page="ManageJellyseerrLibraryContainer">Automated Library Refresh</span> option will refresh any Jellyfin libraries using this folder.</div>
                    </div>

                    <div class="checkboxContainer">
                        <label class="emby-checkbox-label" id="IsEnabledContainer">
                            <input id="IsEnabled" type="checkbox" is="emby-checkbox" data-embycheckbox="true" class="emby-checkbox" />
                            <span class="checkboxLabel">Enable the Automated Task to Sync Jellyseerr and Jellyfin</span>
                            <span class="checkboxOutline">
                                <span class="material-icons checkboxIcon checkboxIcon-checked check" aria-hidden="true"></span>
                                <span class="material-icons checkboxIcon checkboxIcon-unchecked" aria-hidden="true"></span>
                            </span>
                        </label>
                        <div class="helpButton" id="librarySetupHelp" title="Click me! Show library setup instruction before enabling the task.">
                            <span class="helpIcon">?</span>
                            <span style="margin-left: 5px;">Setup</span>
                        </div>
                    </div>

                    <div class="inputContainer" id="SyncIntervalHoursContainer">
                        <input is="emby-input" type="number" id="SyncIntervalHours" label="Sync Interval (Hours)" min="0" max="168" step="0.1"/>
                        <div class="fieldDescription">Defines how often to run the scheduled sync task, allowing partial hours, e.g., 1.5. Set to 0 to disable automatic syncing. <i>Note: Jellyfin delays scheduled tasks for exactly one hour after first-time install and some version upgrades of the plugin.</i></div>
                    </div>

                    <details id="librarySetupInstructions" class="setupInstructions verticalSection" style="display: none;">
                        <summary>üìö Library Setup Instructions</summary>
                        <div id="librarySetupInstructionsContent">
                            <p>Before enabling this plugin, we recommend that you create an empty library. Use the following settings:</p>
                            <ul>
                                <li><strong>Content type:</strong> üé¨ Mixed Movies and Shows</li>
                                <li><strong>Display name:</strong> Anything you'd like! I use "Discover"</li>
                                <li><strong>Folders:</strong> üìÅ Use the default folder <code>/data/JellyBridge</code> OR specify the same root folder as found under <i>Library Settings</i> ‚Üí <i>Library Directory</i></li>
                                <li><strong>Metadata downloaders (TV Shows):</strong> üî≥ Missing Episode Fetcher</li>
                                <li><strong>Metadata savers:</strong> ‚òëÔ∏è Nfo</li>
                                <li>‚òëÔ∏è <strong>Save artwork into media folders</strong></li>
                                <li><strong>Subtitle downloaders:</strong> üî≥ Open Subtitles (<i>if plugin is active</i>)</li>
                            </ul>
                            <p>For advanced setup using Network Folders: <i>Manage Discover Library</i> ‚Üí <span class="link" data-target-page="UseNetworkFoldersContainer"><i>Network Folders</i></span></p>
                        </div>

                        <details id="troubleshootingDetails" class="detailedInstructions">
                            <summary>ü§ñ Troubleshooting</summary>
                            <div class="fieldDescription" style="margin-bottom: 20px;">
                                <p><i>General debugging tips.</i></p>
                                <ol>
                                    <li><strong>Keep your plugin up to date!</strong> Check the latest release from the Catalog (Jellyfin 10.10) or Plugin (Jellyfin 10.11) page.</li>
                                    <li>Your browser may be caching an old version of the plugin configuration page. <span class="link" data-target-script="cacheBuster">Click here to bust your cache</span> and load the latest changes.</li>
                                    <li>This plugin is tested for Jellyfin versions from 10.10.7 to 10.11.4. Other versions may not be fully compatible.</li>
                                </ol>
                                <p><i>The <span class="link" data-target-page="testConnection">üöÄ Test Connection with Jellyseerr</span> button shows an error: Jellyseerr connection error.</i></p>
                                <ol>
                                    <li>Make sure you have <a target="_blank" href="https://docs.seerr.dev/">Jellyseerr</a> installed and running. The <i>Jellyseerr URL</i> must be reachable from your Jellyfin server, so check your Docker container and Jellyfin network settings.</li>
                                    <li>Import Jellyfin users from the Jellyseerr interface: <i>Users</i> ‚Üí <i>Import Jellyfin Users</i>.</li>
                                    <li>Ensure that Jellyseerr is connected to Jellyfin with an admin user. The admin on Jellyseerr's User List should display <i>Jellyfin User</i> under the <i>TYPE</i> column.</li>
                                </ol>
                                <p><i>The <span class="link" data-target-page="testConnection">üöÄ Test Connection with Jellyseerr</span> button shows an error: The library directory is not accessible.</i></p>
                                <ul>
                                    <li>[Windows] Create the library directory: <code>mkdir "C:\ProgramData\Jellyfin\JellyBridge"</code></li>
                                    <li>[Docker] Map the directory in <i>docker-compose.yml</i> > <i>services</i> > <i>Jellyfin</i> > <i>volumes</i>: <code>- /host_mnt/c/ProgramData/Jellyfin/JellyBridge:/data/JellyBridge</code></li>
                                    <li>[Docker] Map the volume in <i>DOCKERFILE</i>: <code>VOLUME /data/JellyBridge</code></li>
                                    <li>[Linux] Create the library directory (capitalization is important!): <code>mkdir -p /data/JellyBridge</code></li>
                                    <li>[Linux] Set permissions on the library directory: <code>sudo chown [username]:[groupname] /data/JellyBridge && sudo chmod 644 /data/JellyBridge</code></li>
                                </ul>
                                <p><i>The Jellyfin library is not showing images or media, or it is out of sync with the JellyBridge folder contents.</i></p>
                                <ol>
                                    <li>If networks are missing movies and shows, try enabling the <span class="link" data-target-page="ManageJellyseerrLibraryContainer">Automated Library Refresh</span> option. Then run the <span class="link" data-target-page="syncDiscover">üì• Import Discover Content from Jellyseerr into JellyBridge Library</span> task manually. Wait until all Jellyfin tasks finish.</li>
                                    <li>Click the <strong>Scan All Libraries</strong> button on the <span class="link" data-target-router="/dashboard">Jellyfin dashboard</span>.</li>
                                    <li>If content is still not updating, open the <span class="link" data-target-router="/metadata">Metadata Manager</span> or <span class="link" data-target-router="/dashboard/libraries">Library Manager</span> and refresh metadata for the JellyBridge library.</li>
                                    <li>As a last resort, click <span class="link" data-target-page="recycleLibraryData">Recycle Library Data</span> and recreate the Jellyfin library according to the <span class="link" data-target-page="librarySetupInstructionsContent">setup instructions above</span>.</li>
                                </ol>
                                <p><i>The <span class="link" data-target-page="syncFavorites">‚≠ê Request JellyBridge Library Favorites in Jellyseerr</span> button is not working, and I am seeing an error message.</i></p>
                                <ol>
                                    <li>Disable CSRF protection in your Jellyseerr instance to allow favorite requests from outside the Jellyseerr interface: Settings ‚Üí Network ‚Üí Uncheck <i>Enable CSRF Protection</i>.</li>
                                </ol>
                            </div>
                        </details>
                    </details>

                    <div>
                        <button is="emby-button" type="button" id="testConnection" class="raised button block emby-button">
                            <span>üöÄ Test Connection with Jellyseerr</span>
                        </button>
                    </div>

                    <br>

                    <details id="syncSettings">
                        <summary>Import Discover Content</summary>
                        <br>
                        <div class="fieldDescription" style="margin-bottom: 16px;">
                            Configure how content is discovered and imported from Jellyseerr. Select which geographic region and networks to pull content from, control how much content is fetched, and set retention policies for discovered items.
                        </div>

                        <div class="inputContainer" id="regionContainer">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="flex: 1;">
                                    <label class="inputLabel inputLabelUnfocused" for="selectWatchRegion">Watch Region <span class="helpIcon" title="Click the refresh button to load all watch regions from Jellyseerr.">?</span></label>
                                    <select id="selectWatchRegion" is="emby-input" class="emby-input emby-select">
                                        <!-- Watch regions will be populated here -->
                                    </select>
                                </div>
                                <button type="button" id="refreshWatchRegions" is="emby-button" class="raised button emby-button" style="margin-top: 30px; height: 40px; width: 40px; padding: 0; display: flex; align-items: center; justify-content: center;" title="Refresh regions">
                                    ‚Üª
                                </button>
                            </div>
                            <div class="fieldDescription">Select your watch region for networks. Click <span class="link" data-target-page="refreshWatchRegions">‚Üª</span> to load watch regions from Jellyseerr. This determines which watch providers are shown for movies and TV shows in the available networks list.</div>
                        </div>

                        <div id="networkServicesContainer" class="inputContainer">
                            <label class="inputLabel inputLabelUnfocused" for="DefaultNetworks">Network Services</label>
                            <div class="fieldDescription">
                                Shown below as: Jellyseerr sort order #. Network Name (Network ID #), and [REGION ID]
                            </div>
                            <div class="multiSelectContainer">
                                <!-- Active Networks (Left) -->
                                <div class="selectBox">
                                    <div class="selectBoxHeader">
                                        <label class="inputLabel">Synced from Jellyseerr</label>
                                    </div>
                                    <div class="searchInputContainer">
                                        <input type="text" id="activeNetworkSearch" placeholder="Search active networks..." class="emby-input">
                                        <button type="button" id="clearActiveNetworkSearch" class="clearSearchButton" title="Clear search">√ó</button>
                                    </div>
                                    <select id="activeNetworks" multiple is="emby-input" class="emby-input emby-select">
                                        <!-- Active networks will be populated here -->
                                    </select>
                                </div>
                                
                                <!-- Arrow Buttons (Center) -->
                                <div class="arrowButtonsContainer">
                                    <button type="button" id="refreshAvailableNetworks" is="emby-button" class="raised button emby-button arrowButton" title="Refresh available networks">‚Üª</button>
                                    <button type="button" id="addSelectedNetworks" is="emby-button" class="raised button emby-button arrowButton" title="Add selected networks">‚Üê</button>
                                    <button type="button" id="removeSelectedNetworks" is="emby-button" class="raised button emby-button arrowButton" title="Remove selected networks">‚Üí</button>
                                </div>
                                
                                <!-- Available Networks (Right) -->
                                <div class="selectBox" id="availableNetworksSelectBox">
                                    <div class="selectBoxHeader">
                                        <label class="inputLabel">Available Networks in Watch Region <span class="helpIcon" title="Click the refresh button to load all service networks from Jellyseerr. The defaults only include those from Jellyseerr's Network Slider.">?</span></label>
                                    </div>
                                    <div class="searchInputContainer">
                                        <input type="text" id="availableNetworkSearch" placeholder="Search available networks..." class="emby-input">
                                        <button type="button" id="clearAvailableNetworkSearch" class="clearSearchButton" title="Clear search">√ó</button>
                                    </div>
                                    <select id="availableNetworks" multiple is="emby-input" class="emby-input emby-select">
                                        <!-- Available networks will be populated here -->
                                    </select>
                                </div>
                            </div>
                            <div class="fieldDescription">Click <span class="link" data-target-page="refreshAvailableNetworks">‚Üª</span> to load available networks from Jellyseerr. Select networks from the right box and move them to the left box. Use the search boxes to filter networks. Feel free to add networks from other watch regions.</div>
                        </div>

                        <div class="inputContainer">
                            <input id="MaxDiscoverPages" type="number" is="emby-input" min="0" label="Discover Pages"/>
                            <div class="fieldDescription">Maximum number of pages to import from the Jellyseerr discover pages for each network. Each page consists of 20 shows for each network. This applies to both movies and TV shows discovery. Enter 0 to retrieve ALL pages (try a smaller number first).</div>
                        </div>

                        <div class="inputContainer">
                            <input id="MaxRetentionDays" type="number" is="emby-input" min="1" label="Content Retention Time (Days)"/>
                            <div class="fieldDescription">Maximum number of days to retain items in the collection before cleanup. JellyBridge items older than this will be removed after running the import task.</div>
                        </div>

                        <div>
                            <button is="emby-button" type="button" id="syncDiscover" class="raised button block emby-button">
                                <span>üì• Import Discover Content from Jellyseerr into JellyBridge Library</span>
                            </button>
                            <div id="syncDiscoverResult" class="testResult emby-textarea"></div>
                        </div>

                    </details>

                    <br>

                    <details id="manageLibrarySettings">
                        <summary>Manage Discover Library</summary>
                        <br>
                        <div class="fieldDescription">
                            Manage how the JellyBridge library interacts with your Jellyfin installation. Configure automatic library refreshing, hide existing Jellyfin items from discover content, and unfavorite requested items. With a few extra steps, organize discover content based on the network.
                        </div>
                        <div class="fieldDescription cautionText" style="margin-bottom: 16px;">
                            üôà Display: JellyBridge hides movie or show items in the library by creating an .ignore file in the item folder.
                            <br>
                            üìã Process: After a request is sent to Jellyseerr, requested items are always marked as unplayed for all users and hidden from all libraries. If you deny all requests for that item in Jellyseerr, the item will repopulate on next sync.
                        </div>

                        <div id="ManageJellyseerrLibraryContainer" class="checkboxContainer checkboxContainer-withDescription">
                            <label class="emby-checkbox-label">
                                <input id="ManageJellyseerrLibrary" type="checkbox" is="emby-checkbox" data-embycheckbox="true" class="emby-checkbox" />
                                <span class="checkboxLabel">Automated Library Refresh</span>
                                <span class="checkboxOutline">
                                    <span class="material-icons checkboxIcon checkboxIcon-checked check" aria-hidden="true"></span>
                                    <span class="material-icons checkboxIcon checkboxIcon-unchecked" aria-hidden="true"></span>
                                </span>
                            </label>
                            <div class="fieldDescription">After syncing, refreshes all Jellyfin libraries that contain the JellyBridge <i>Library Directory</i> path. Runs a partial refresh <i>üîÑ Search for missing metadata ‚úÖ Replace all images</i> (this may take more time to retrieve new media data from TMDB and other providers), and an additional full refresh <i>üîÑReplace all metadata</i> if items are hidden or deleted (this takes less time).</div>
                        </div>

                        <div class="checkboxContainer checkboxContainer-withDescription">
                            <label class="emby-checkbox-label">
                                <input id="ExcludeFromMainLibraries" type="checkbox" is="emby-checkbox" data-embycheckbox="true" class="emby-checkbox" />
                                <span class="checkboxLabel">Hide Existing Discover Content</span>
                                <span class="checkboxOutline">
                                    <span class="material-icons checkboxIcon checkboxIcon-checked check" aria-hidden="true"></span>
                                    <span class="material-icons checkboxIcon checkboxIcon-unchecked" aria-hidden="true"></span>
                                </span>
                            </label>
                            <div class="fieldDescription">When enabled, the JellyBridge library will hide movies and shows that are found in your other Jellyfin libraries.</div>
                        </div>

                        <div class="checkboxContainer checkboxContainer-withDescription">
                            <label class="emby-checkbox-label">
                                <input id="RemoveRequestedFromFavorites" type="checkbox" is="emby-checkbox" data-embycheckbox="true" class="emby-checkbox" />
                                <span class="checkboxLabel">Favorite Cleanup</span>
                                <span class="checkboxOutline">
                                    <span class="material-icons checkboxIcon checkboxIcon-checked check" aria-hidden="true"></span>
                                    <span class="material-icons checkboxIcon checkboxIcon-unchecked" aria-hidden="true"></span>
                                </span>
                            </label>
                            <div class="fieldDescription">When enabled, this option removes favorited items for all users after the items are requested from Jellyseerr. This setting is to prevent favorited items from interfering with other plugins like <a target="_blank" href="https://github.com/shemanaev/jellyfin-plugin-media-cleaner">Media Cleaner for Jellyfin</a>.</div>
                        </div>
                        
                        <div class="checkboxContainer checkboxContainer-withDescription" id="UseNetworkFoldersContainer">
                            <label class="emby-checkbox-label">
                                <input id="UseNetworkFolders" type="checkbox" is="emby-checkbox" data-embycheckbox="true" class="emby-checkbox" />
                                <span class="checkboxLabel">Network Folders</span>
                                <span class="checkboxOutline">
                                    <span class="material-icons checkboxIcon checkboxIcon-checked check" aria-hidden="true"></span>
                                    <span class="material-icons checkboxIcon checkboxIcon-unchecked" aria-hidden="true"></span>
                                </span>
                            </label>
                            <div class="fieldDescription">When enabled, separate folders will be created for each network, e.g., Netflix, Hulu, FOX. Recommended when organizing different networks into multiple Jellyfin libraries, e.g., Network TV, Premium, Streaming. <i>Note: When <span class="link" data-target-page="ManageJellyseerrLibraryContainer">Automated Library Refresh</span> is enabled, Jellyfin may take a while to refresh all JellyBridge libraries.</i></div>
                        </div>

                        <details id="networkFolderOptionsDetails" class="detailedInstructions">
                            <summary>Network Folders Setup</summary>
                            <div>
                                <h4>Instructions</h4>
                                <p>Do this before clicking <span class="link" data-target-page="syncDiscover">Sync Discover Content from Jellyseerr to JellyBridge Library</span> or running the <span class="link" data-target-page="IsEnabledContainer">Automated Task to Sync Jellyseerr and Jellyfin</span>. This allows the sync task to refresh the libraries after importing discover content.</p>
                                <ol>
                                    <li>Choose your <span class="link" data-target-page="regionContainer">Watch Region</span>. Select networks from the list available that you want to store in the Jellybridge library: <span class="link" data-target-page="networkServicesContainer">Network Services</span>.</li>
                                    <li>Click the <span class="link" data-target-page="generateNetworkFolders">üóÇÔ∏è Generate Network Folders</span> button below.</li>
                                    <li>Create any number of Jellyfin libraries. Each network folder must have a unique Jellyfin library.</li>
                                    <li>For each library, follow the <span class="link" data-target-page="librarySetupInstructions">Library Setup Instructions</span>.</li>
                                </ol>
                                <div class="fieldDescription cautionText" style="margin-bottom: 16px;">
                                    ‚ö†Ô∏è Caution: To display the items in the Jellyfin library without seeing the annoying folder icons, you must add network subdirectories to the Jellyfin Folders rather than the base Library Directory. Alternatively, you can use different libraries for each network provider.
                                </div>

                                <div class="inputContainer" id="LibraryPrefixContainer">
                                    <input id="LibraryPrefix" type="text" is="emby-input" label="Library Prefix"/>
                                    <div class="fieldDescription">Prefix for network library names. The folder structure for the prefix "Network - " would look like:<br><code>/data/JellyBridge/Network - FOX/The Matrix (1999)</code></div>
                                </div>

                                <div class="checkboxContainer checkboxContainer-withDescription" id="AddDuplicateContentContainer">
                                    <label class="emby-checkbox-label">
                                        <input id="AddDuplicateContent" type="checkbox" is="emby-checkbox" data-embycheckbox="true" class="emby-checkbox" />
                                        <span class="checkboxLabel">Show Discover Content in Multiple Libraries</span>
                                        <span class="checkboxOutline">
                                            <span class="material-icons checkboxIcon checkboxIcon-checked check" aria-hidden="true"></span>
                                            <span class="material-icons checkboxIcon checkboxIcon-unchecked" aria-hidden="true"></span>
                                        </span>
                                    </label>
                                    <div class="fieldDescription">When enabled, copies content to each JellyBridge library when multiple networks host the same content. For example, both HBO and Hulu have "Friends" in their discover content, and both networks are in separate Jellyfin libraries, then each library has a copy of "Friends". <i>Unchecking this box will only import discover content that is unique across all JellyBridge libraries.</i></div>
                                    <div id="addDuplicateContentWarning" class="fieldDescription cautionText" style="display: none;">
                                        <strong>üí° Recommended:</strong> If you have already synced discover content, you should manually <span class="link" data-target-page="recycleLibraryData">Recycle JellyBridge Library Data</span> to remove the existing data.
                                        <br>
                                        <strong>‚ö†Ô∏è Caution:</strong> You should not include the same network in multiple libraries, as duplicates may occur within libraries.
                                    </div>
                                </div>

                                <div id="generateNetworkFoldersContainer" class="fieldDescription">
                                    <button is="emby-button" type="button" id="generateNetworkFolders" class="raised button block emby-button">
                                        <span>üóÇÔ∏è Generate Network Folders</span>
                                    </button>
                                </div>
                            </div>
                        </details>

                        <div>
                            <button is="emby-button" type="button" id="syncFavorites" class="raised button block emby-button">
                                <span>‚≠ê Request JellyBridge Library Favorites in Jellyseerr</span>
                            </button>
                            <div id="syncFavoritesResult" class="testResult emby-textarea"></div>
                        </div>

                    </details>

                    <br>

                    <details id="sortContentSettings">
                        <summary>Sort Discover Content</summary>
                        <br>
                        <div class="fieldDescription">
                            Control the sort order of items in the JellyBridge library by setting a generated play count and last played date of media items for all users. This allows users to see content in a different order each time.</i>
                        </div>
                        <div class="fieldDescription cautionText" style="margin-bottom: 16px;">
                            ‚ú≥Ô∏è Instructions: To enable this feature, each user must open the JellyBridge library and change the default sort option <i>Sort by Folder</i> to <i>Sort by <strong>Play count</strong> (Sort order <strong>Ascending</strong>)</i>. For Android TV users, sort by <i><strong>Last Played</strong></i>.
                            <br>
                            ‚ö†Ô∏è Caution: Recommended to disable sorting for Kodi integration, which has native support for random or recommended sorting. The sorting feature will trigger many updates in the Kodi Add-on, although they finish relatively quickly.
                        </div>

                        <div id="EnableAutomatedSortTaskContainer" class="checkboxContainer checkboxContainer-withDescription">
                            <label class="emby-checkbox-label">
                                <input id="EnableAutomatedSortTask" type="checkbox" is="emby-checkbox" data-embycheckbox="true" class="emby-checkbox" />
                                <span class="checkboxLabel">Enable the Automated Task to Sort Discover Content</span>
                                <span class="checkboxOutline">
                                    <span class="material-icons checkboxIcon checkboxIcon-checked check" aria-hidden="true"></span>
                                    <span class="material-icons checkboxIcon checkboxIcon-unchecked" aria-hidden="true"></span>
                                </span>
                            </label>
                            <div class="fieldDescription">Enables the automated scheduled task that periodically updates play counts to sort JellyBridge library content.</div>
                        </div>

                        <div class="inputContainer" id="SortTaskIntervalHoursContainer">
                            <input is="emby-input" type="number" id="SortTaskIntervalHours" label="Sort Task Interval (Hours)" min="0" max="168" step="0.1"/>
                            <div class="fieldDescription">Defines how often to run the sort task, allowing partial hours, e.g., 1.5. Set to 0 to disable automatic sort randomization. <i>Note: Jellyfin delays scheduled tasks for exactly one hour after first-time install and some version upgrades of the plugin.</i></div>
                        </div>

                        <div class="inputContainer">
                            <label class="inputLabel" for="selectSortOrder">Sort Order</label>
                            <select id="selectSortOrder" is="emby-input" class="emby-input emby-select">
                                <!-- Options will be populated dynamically from enum -->
                            </select>
                            <div class="fieldDescription">Selects the algorithm used to sort JellyBridge library content. <i>None</i>: sets play counts to zero. <i>Random</i>: randomizes play counts. <i>Smart</i>: (semi-)intelligent sorting based on genres in each user's library. <i>Smartish</i>: smart sort with a little randomness.</div>
                        </div>

                        <div class="checkboxContainer checkboxContainer-withDescription">
                            <label class="emby-checkbox-label">
                                <input id="MarkMediaPlayed" type="checkbox" is="emby-checkbox" data-embycheckbox="true" class="emby-checkbox" />
                                <span class="checkboxLabel">Mark Media Played</span>
                                <span class="checkboxOutline">
                                    <span class="material-icons checkboxIcon checkboxIcon-checked check" aria-hidden="true"></span>
                                    <span class="material-icons checkboxIcon checkboxIcon-unchecked" aria-hidden="true"></span>
                                </span>
                            </label>
                            <div class="fieldDescription">This feature changes badges to a üîµ‚úì badge. For shows: changes the üîµ1 unplayed count badge. For movies: changes from no badge. Disabling this option changes all media to unplayed badge when sorting.</div>
                        </div>

                        <div>
                            <button is="emby-button" type="button" id="sortContent" class="raised button block emby-button">
                                <span>üé≤ Refresh Discover Library Sort Order</span>
                            </button>
                            <div id="sortContentResult" class="testResult emby-textarea"></div>
                        </div>

                    </details>

                    <br>

                    <details id="advancedSettings">
                        <summary>Advanced</summary>
                        <br>
                        <div class="fieldDescription" style="margin-bottom: 16px;">
                            Configure advanced options including startup behavior, timeout settings, placeholder video configuration, and logging levels. Use these settings to fine-tune plugin behavior and troubleshoot issues. The <span class="link" data-target-page="cleanupMetadata">Cleanup Metadata</span> button will remove folders that are missing metadata or have out-dated metadata in the JellyBridge library.
                        </div>

                        <div class="checkboxContainer checkboxContainer-withDescription">
                            <label class="emby-checkbox-label">
                                <input id="EnableStartupSync" type="checkbox" is="emby-checkbox" data-embycheckbox="true" class="emby-checkbox" />
                                <span class="checkboxLabel">Run Automated Tasks on Plugin Startup</span>
                                <span class="checkboxOutline">
                                    <span class="material-icons checkboxIcon checkboxIcon-checked check" aria-hidden="true"></span>
                                    <span class="material-icons checkboxIcon checkboxIcon-unchecked" aria-hidden="true"></span>
                                </span>
                            </label>
                            <div id="enableStartupSyncDescription" class="fieldDescription">Automatically run all enabled automated tasks when the plugin starts up or when Jellyfin restarts.</div>
                        </div>

                        <div class="inputContainer" id="StartupDelaySecondsContainer">
                            <input id="StartupDelaySeconds" type="number" is="emby-input" min="0" max="900" label="Startup Delay (seconds)"/>
                            <div class="fieldDescription">Delay a number of seconds before running the auto-sync task on startup, in addition to the 1-minute default delay for startup tasks. Useful when Jellyfin takes more than 1 minute to start, which you can check in the logs: <i>Main: Startup complete</i></div>
                        </div>

                        <div class="inputContainer">
                            <input id="TaskTimeoutMinutes" type="number" is="emby-input" min="1" max="1440" label="Task Queue Timeout (minutes)"/>
                            <div class="fieldDescription">How long to wait for plugin tasks (sync, sort, etc.) to finish before exiting the task queue. This option will not cancel running tasks.</div>
                        </div>

                        <div class="inputContainer">
                            <input id="RequestTimeout" type="number" is="emby-input" min="1" max="3600" label="Request Timeout (seconds)"/>
                            <div class="fieldDescription">Timeout for API requests to Jellyseerr.</div>
                        </div>

                        <div class="inputContainer">
                            <input id="RetryAttempts" type="number" is="emby-input" min="0" max="100" label="Retry Attempts"/>
                            <div class="fieldDescription">Number of retry attempts for failed API requests to Jellyseerr.</div>
                        </div>

                        <div class="inputContainer">
                            <input id="PlaceholderDurationSeconds" type="number" is="emby-input" min="1" max="3600" label="Placeholder Video Duration (seconds)"/>
                            <div class="fieldDescription">Length of generated placeholder videos in the JellyBridge library. The video uses a negligible amount of disk space, e.g., a ten-second video is approximately 100kb.</div>
                        </div>

                        <div class="checkboxContainer checkboxContainer-withDescription">
                            <label class="emby-checkbox-label">
                                <input id="EnableDebugLogging" type="checkbox" is="emby-checkbox" data-embycheckbox="true" class="emby-checkbox" />
                                <span class="checkboxLabel">Enable Debug Logging</span>
                                <span class="checkboxOutline">
                                    <span class="material-icons checkboxIcon checkboxIcon-checked check" aria-hidden="true"></span>
                                    <span class="material-icons checkboxIcon checkboxIcon-unchecked" aria-hidden="true"></span>
                                </span>
                            </label>
                            <div class="fieldDescription">Enable detailed debug logging for troubleshooting. This redirects the lower log levels to the Information log level to workaround the clunky logging system in Jellyfin.</div>
                        </div>

                        <div class="checkboxContainer checkboxContainer-withDescription" id="EnableTraceLoggingContainer">
                            <label class="emby-checkbox-label">
                                <input id="EnableTraceLogging" type="checkbox" is="emby-checkbox" data-embycheckbox="true" class="emby-checkbox" />
                                <span class="checkboxLabel">Enable Trace Logging</span>
                                <span class="checkboxOutline">
                                    <span class="material-icons checkboxIcon checkboxIcon-checked check" aria-hidden="true"></span>
                                    <span class="material-icons checkboxIcon checkboxIcon-unchecked" aria-hidden="true"></span>
                                </span>
                            </label>
                            <div class="fieldDescription">Enable trace-level logging for even more detailed information. This is the most verbose logging level and creates a lot of log entries.</div>
                        </div>

                        <div>
                            <button is="emby-button" type="button" id="cleanupMetadata" class="raised button block emby-button">
                                <span>üßπ Cleanup Metadata</span>
                            </button>
                            <div id="cleanupMetadataResult" class="testResult emby-textarea"></div>
                        </div>

                        <div style="margin-top: 20px; padding: 15px; background-color: rgba(211, 47, 47, 0.1); border: 1px solid #d32f2f; border-radius: 5px;">
                            <button is="emby-button" type="button" id="recycleLibraryData" class="raised button block emby-button" style="background-color: #d32f2f; color: white;">
                                <span>üóëÔ∏è Recycle JellyBridge Library Data</span>
                            </button>
                            <div class="fieldDescription criticalText">
                                <strong>‚ò†Ô∏è CRITICAL:</strong> This will permanently delete all data from the JellyBridge <i>Library Directory</i>. This action may result in irreversible data loss. The prompt will ask for confirmation twice to confirm this action.
                            </div>
                            <div class="fieldDescription cautionText">
                                <strong>‚ö†Ô∏è IMPORTANT:</strong> After deleting library data, you should delete the JellyBridge libraries containing the <i>Library Directory</i> path. Recreate the Jellyfin libraries for JellyBridge using the <span class="link" data-target-page="librarySetupHelp">setup instructions at the top of this page</span>. This repairs the Jellyfin metadata and prevents errors when adding new content.
                            </div>
                        </div>

                    </details>

                    <br>

                    <div>
                        <button is="emby-button" type="submit" id="saveConfig" class="raised button-submit block emby-button">
                            <span>üíæ Save</span>
                        </button>
                    </div>
                    
                    <div style="margin-top: 10px;">
                        <button is="emby-button" type="button" id="resetPluginConfig" class="raised button block emby-button" style="background-color: #757575; border: 1px solid #bbb; color: white;">
                            <span>‚ôªÔ∏è Reset Configuration</span>
                        </button>
                    </div>
                </fieldset>
            </form>
            
            <div class="readOnlyContent" style="margin-top: 20px; text-align: center;">
                <p style="margin: 0;">
                    <a target="_blank" href="https://kinggeorges12.github.io/JellyBridge/" style="color: #2196f3; text-decoration: none; font-size: 1em;">
                        <strong>üìñ Documentation & Help ‚ùì</strong>
                    </a>
                </p>
            </div>
            
            <div class="readOnlyContent" style="margin-top: 60px; background-color: rgba(0,0,0,0.1); border-radius: 5px; color: #888;">
                <p style="font-size: 0.9em;">
                    <strong>Credits & Acknowledgments:</strong>
                    <br>
                    Thank you to the creator of the <a target="_blank" href="https://github.com/geekfreak21/Overseer-and-Jellyfin-Bridged" style="color: #2196f3;">Overseer-Jellyfin Bridge Script</a> for the inspiration. Special thanks to the developers of the <a target="_blank" href="https://github.com/intro-skipper" style="color: #2196f3;">Intro Skipper</a> and <a target="_blank" href="https://github.com/IAmParadox27/jellyfin-plugin-custom-tabs" style="color: #2196f3;">Custom Tabs</a> plugins for reusing their GPL-licensed code in the UI styling and configuration patterns.
                    <br>
                    And of course, thanks to the developers of <a target="_blank" href="https://jellyfin.org/" style="color: #2196f3;">Jellyfin</a> and <a target="_blank" href="https://seerr.dev/" style="color: #2196f3;">Jellyseerr</a> for making it all possible.
                </p>
            </div>
        </div>
    </div>
</div>