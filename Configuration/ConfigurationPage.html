<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Jellyseerr Bridge v0.28 - MINIMAL BASIC CONFIG</title>
</head>
<body>
    <div id="TemplateConfigPage" data-role="page" class="page type-interior pluginConfigurationPage" data-require="emby-input,emby-button">
        <div data-role="content">
            <div class="content-primary">
                <form id="JellyseerrConfigForm">
                    <fieldset class="verticalSection-extrabottompadding">
                        <legend>Basic Configuration</legend>
                        
                        <div class="inputContainer">
                            <label class="inputLabel inputLabelUnfocused">Jellyseerr URL</label>
                            <input id="JellyseerrUrl" type="text" is="emby-input" />
                            <div class="fieldDescription">The base URL of your Jellyseerr instance (e.g., http://localhost:5055)</div>
                        </div>

                        <div class="inputContainer">
                            <label class="inputLabel inputLabelUnfocused">API Key</label>
                            <input id="ApiKey" type="password" is="emby-input" />
                            <div class="fieldDescription">Your Jellyseerr API key</div>
                        </div>

                        <div class="inputContainer">
                            <label class="inputLabel inputLabelUnfocused">Library Directory</label>
                            <input id="LibraryDirectory" type="text" is="emby-input" />
                            <div class="fieldDescription">Directory path for Jellyseerr library files</div>
                        </div>

                        <div class="inputContainer">
                            <label class="inputLabel inputLabelUnfocused">User ID</label>
                            <input id="UserId" type="number" is="emby-input" min="1" />
                            <div class="fieldDescription">Jellyseerr user ID for requests</div>
                        </div>

                        <button id="saveConfig" is="emby-button" type="submit" class="emby-button raised button-submit block" style="width: 100%;">
                            <span>Save Configuration</span>
                        </button>
                    </fieldset>
                </form>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        if (typeof JellyseerrConfig == 'undefined') {
            const JellyseerrConfig = {
                pluginId: "088e8efc-6855-42ec-bcc9-24fde6da7149",
                form: document.querySelector("#JellyseerrConfigForm"),
                btnSave: document.querySelector("#saveConfig"),

                saveConfig: function (e) {
                    e.preventDefault();
                    Dashboard.showLoadingMsg();

                    const config = {
                        JellyseerrUrl: document.querySelector("#JellyseerrUrl").value,
                        ApiKey: document.querySelector("#ApiKey").value,
                        LibraryDirectory: document.querySelector("#LibraryDirectory").value,
                        UserId: parseInt(document.querySelector("#UserId").value) || 1
                    };

                    ApiClient.ajax({
                        url: ApiClient.getUrl('Plugins/Configuration', { key: JellyseerrConfig.pluginId }),
                        type: 'POST',
                        data: JSON.stringify(config),
                        contentType: 'application/json'
                    }).then(Dashboard.processPluginConfigurationUpdateResult)
                      .catch(function (error) {
                          console.error('Configuration save error:', error);
                          Dashboard.alert('Failed to save configuration: ' + error.message);
                      })
                      .finally(function () {
                          Dashboard.hideLoadingMsg();
                      });
                },

                loadConfig: function () {
                    Dashboard.showLoadingMsg();

                    ApiClient.ajax({
                        url: ApiClient.getUrl('Plugins/Configuration', { key: JellyseerrConfig.pluginId }),
                        type: 'GET'
                    }).then(function (config) {
                        document.querySelector("#JellyseerrUrl").value = config.JellyseerrUrl || '';
                        document.querySelector("#ApiKey").value = config.ApiKey || '';
                        document.querySelector("#LibraryDirectory").value = config.LibraryDirectory || '/data/Jellyseerr';
                        document.querySelector("#UserId").value = config.UserId || 1;
                    }).catch(function (error) {
                        console.error('Configuration load error:', error);
                    }).finally(function () {
                        Dashboard.hideLoadingMsg();
                    });
                },

                init: function () {
                    JellyseerrConfig.btnSave.addEventListener("click", JellyseerrConfig.saveConfig);
                    JellyseerrConfig.loadConfig();
                }
            };

            document.querySelector('#TemplateConfigPage').addEventListener("pageshow", function () {
                JellyseerrConfig.init();
            });
        }
    </script>
</body>
</html>